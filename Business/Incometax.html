<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Income Tax Calculator — currency auto-convert + section boxes</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
  :root{
    --bg:#f4f7f6; --card:#fff; --muted:#6b7176; --accent:#0b7285;
    --green:#10b981; --panel:#eef7f4; --section-bg:#eaf6ff;
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#0b1720;-webkit-font-smoothing:antialiased}
  .wrap{max-width:980px;margin:18px auto;padding:14px}
  .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 8px 28px rgba(6,9,12,.06)}
  .header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .currencyBox{display:flex;flex-direction:column;gap:6px;min-width:130px}
  .titleWrap{flex:1}
  .title{font-size:22px;margin:0;font-weight:800}
  .subtitle{color:var(--muted);margin:2px 0 0;font-size:13px}
  .grid{display:grid;grid-template-columns:1fr;gap:18px}
  @media(min-width:920px){ .grid{grid-template-columns:380px 1fr} }
  .panel{background:linear-gradient(180deg,#fff,#fbfdff);padding:14px;border-radius:12px;border:1px solid rgba(12,18,24,0.06)}
  label{display:block;font-weight:600;margin-bottom:6px}
  .input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(12,18,24,0.12);font-size:16px;background:transparent}
  .row{display:flex;gap:12px}
  .row .col{flex:1}
  .small{font-size:13px;color:var(--muted);margin-top:6px}
  .btn{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  .btnGhost{background:#fff;border:1px solid rgba(12,18,24,0.08);padding:9px 12px;border-radius:10px;cursor:pointer}
  .select{padding:10px;border-radius:10px;border:1px solid rgba(12,18,24,0.08);font-size:15px}
  .resultCard{border-radius:12px;padding:10px;overflow:hidden}
  .resultTop{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#f7fffa,#f1fdf7)}
  .bigVal{font-size:36px;font-weight:800;color:var(--green)}
  .filingLabel{font-weight:700;color:#0b1720}
  .resultTable{width:100%;border-collapse:collapse;margin-top:10px}
  .resultTable td{padding:12px;border-bottom:1px solid rgba(6,9,12,.06)}
  .resultTable .label{color:var(--muted);font-weight:600}
  .resultTable .value{font-weight:800;text-align:right}
  .resultTable .section{background:var(--panel);font-weight:800}
  .resultFooter{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:8px;background:#f3ffef;margin-top:8px;font-weight:800}
  .muted{color:var(--muted);font-size:13px}
  .note{font-size:13px;color:var(--muted);margin-top:8px}

  /* custom section title pill */
  .sectionTitle{
    display:inline-flex;
    align-items:center;
    padding:8px 12px;
    border-radius:999px;
    background:linear-gradient(90deg,#e6f7ff,#dff3ff);
    color:#064a6b;
    font-weight:700;
    margin:10px 0;
    border:1px solid rgba(6,74,107,0.08);
  }

  @media(max-width:600px){
    .bigVal{font-size:30px}
    .header{flex-direction:column;align-items:flex-start}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="header">
      <!-- currency section moved to LEFT as requested -->
      <div class="currencyBox">
        <label class="small">Currency (auto-convert)</label>
        <select id="currency" class="select" aria-label="Currency">
          <option value="USD">$ USD</option>
          <option value="EUR">€ EUR</option>
          <option value="INR">₹ INR</option>
        </select>
      </div>

      <div class="titleWrap">
        <h1 class="title">Income Tax Calculator — Estimator</h1>
        <div class="subtitle">AMT & NIIT approximations. Tax years up to 2028. Export results to PNG.</div>
      </div>

      <div style="min-width:120px;text-align:right">
        <label class="small">Rates (1 USD =)</label>
        <div style="display:flex;gap:6px">
          <input id="rateUSD" class="input" style="width:56px;padding:8px" value="1" />
          <input id="rateEUR" class="input" style="width:72px;padding:8px" value="0.92" />
          <input id="rateINR" class="input" style="width:72px;padding:8px" value="83.5" />
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="panel" aria-label="Inputs panel">
        <label for="taxYearSelect">Tax year (return for)</label>
        <select id="taxYearSelect" class="input">
          <option value="2025">2025</option>
          <option value="2026">2026</option>
          <option value="2027">2027</option>
          <option value="2028">2028</option>
        </select>

        <div style="margin-top:10px">
          <label for="filing">Filing status</label>
          <select id="filing" class="input">
            <option value="single">Single</option>
            <option value="married_joint">Married filing jointly</option>
            <option value="married_separate">Married filing separately</option>
            <option value="head">Head of household</option>
            <option value="widow">Qualified widow(er)</option>
          </select>
        </div>

        <div style="margin-top:12px">
          <label for="age">Age</label>
          <input id="age" class="input" type="number" min="0" value="30" />
        </div>

        <!-- section title pill -->
        <div class="sectionTitle">Income (edit values)</div>

        <div style="display:grid;gap:10px">
          <input id="wages" class="input numeric" type="number" placeholder="Wages, tips etc." value="8000" />
          <input id="interest" class="input numeric" type="number" placeholder="Interest income" value="0" />
          <input id="dividends" class="input numeric" type="number" placeholder="Ordinary dividends" value="0" />
          <input id="qualifiedDiv" class="input numeric" type="number" placeholder="Qualified dividends" value="0" />
          <div class="row">
            <div class="col"><input id="stcg" class="input numeric" type="number" placeholder="Short-term capital gains" value="0" /></div>
            <div class="col"><input id="ltcg" class="input numeric" type="number" placeholder="Long-term capital gains" value="0" /></div>
          </div>
          <input id="selfBiz" class="input numeric" type="number" placeholder="Self-employment / business income" value="0" />
          <input id="passive" class="input numeric" type="number" placeholder="Passive income / rentals" value="0" />
          <input id="social" class="input numeric" type="number" placeholder="Social Security income" value="0" />
        </div>

        <div class="sectionTitle">Deductions & credits</div>

        <div style="display:grid;gap:10px">
          <input id="mortgage" class="input numeric" type="number" placeholder="Mortgage interest" value="0" />
          <input id="realEstate" class="input numeric" type="number" placeholder="Real estate tax" value="0" />
          <input id="charity" class="input numeric" type="number" placeholder="Charitable donations" value="0" />
          <input id="studentLoan" class="input numeric" type="number" placeholder="Student loan interest" value="0" />
          <input id="ira" class="input numeric" type="number" placeholder="IRA contributions" value="0" />
          <input id="otherDed" class="input numeric" type="number" placeholder="Other deductible expenses" value="0" />
          <input id="ctc" class="input numeric" type="number" placeholder="Child tax credit (estimate)" value="0" />
          <input id="otherCredits" class="input numeric" type="number" placeholder="Other tax credits" value="0" />
        </div>

        <div style="margin-top:12px">
          <label class="small">Withholdings & prepayments</label>
          <div style="display:grid;gap:10px">
            <input id="fedWithheld" class="input numeric" type="number" placeholder="Federal tax withheld" value="6000" />
            <input id="stateWithheld" class="input numeric" type="number" placeholder="State tax withheld" value="0" />
            <input id="prepayments" class="input numeric" type="number" placeholder="Estimated tax prepayments" value="0" />
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:14px">
          <button id="calculateBtn" class="btn">Calculate</button>
          <button id="clearBtn" class="btnGhost">Reset</button>
          <button id="exportBtn" class="btnGhost">Export PNG</button>
        </div>

        <div class="note">Switch currency above — numeric input values will be converted automatically using the rates shown.</div>
      </div>

      <!-- results -->
      <div class="resultCard panel" id="resultPanel" role="region" aria-live="polite">
        <div class="resultTop">
          <div>
            <div class="muted">Estimated refund / balance for <span id="resYear"></span></div>
            <div class="bigVal" id="estAmount">$0</div>
          </div>
          <div style="text-align:right">
            <div class="muted">Filing</div>
            <div class="filingLabel" id="resFiling">Single</div>
            <div class="muted" style="margin-top:6px">Currency: <span id="resCurrency">$</span></div>
          </div>
        </div>

        <table class="resultTable">
          <tr class="section"><td class="label">Total Income</td><td class="value" id="resTotalIncome">$0</td></tr>
          <tr><td class="label">Wages & Compensation</td><td class="value" id="resWages">$0</td></tr>
          <tr><td class="label">Interest & Dividends</td><td class="value" id="resInterest">$0</td></tr>
          <tr><td class="label">Capital gains (ST/LT)</td><td class="value" id="resCapGains">$0</td></tr>
          <tr><td class="label">Business / Passive / Other</td><td class="value" id="resBiz">$0</td></tr>

          <tr class="section"><td class="label">Total Deductions (std or itemized)</td><td class="value" id="resTotalDed">$0</td></tr>
          <tr><td class="label">Taxable Income</td><td class="value" id="resTaxable">$0</td></tr>

          <tr class="section"><td class="label">Regular Taxes (federal)</td><td class="value" id="resRegularTax">$0</td></tr>
          <tr><td class="label">Alternative Minimum Tax (AMT) — approx.</td><td class="value" id="resAMT">$0</td></tr>
          <tr><td class="label">Net Investment Income Tax (NIIT) — approx.</td><td class="value" id="resNIIT">$0</td></tr>

          <tr><td class="label">All Tax Credits</td><td class="value" id="resAllCredits">$0</td></tr>
          <tr class="section"><td class="label">Total Tax with Credits</td><td class="value" id="resTaxWithCredits">$0</td></tr>
          <tr><td class="label">Federal tax withheld + prepayments</td><td class="value" id="resPrepay">$0</td></tr>
        </table>

        <div class="resultFooter">
          <div class="muted">Estimated refund</div>
          <div id="finalRefund" style="font-weight:900;font-size:20px">$0</div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* shortcuts */
const $ = id => document.getElementById(id);

/* inputs */
const currencySel = $('currency');
const rateUSD = $('rateUSD'), rateEUR = $('rateEUR'), rateINR = $('rateINR');
const taxYearSelect = $('taxYearSelect'), filing = $('filing'), ageEl = $('age');
const numericInputs = ()=> Array.from(document.querySelectorAll('.numeric'));
const wages = $('wages'), interest = $('interest'), dividends = $('dividends'), qualifiedDiv = $('qualifiedDiv');
const stcg = $('stcg'), ltcg = $('ltcg'), selfBiz = $('selfBiz'), passive = $('passive'), social = $('social');
const mortgage = $('mortgage'), realEstate = $('realEstate'), charity = $('charity'), studentLoan = $('studentLoan'), ira = $('ira'), otherDed = $('otherDed');
const ctc = $('ctc'), otherCredits = $('otherCredits');
const fedWithheld = $('fedWithheld'), stateWithheld = $('stateWithheld'), prepayments = $('prepayments');

const calculateBtn = $('calculateBtn'), clearBtn = $('clearBtn'), exportBtn = $('exportBtn');

/* results */
const resYear = $('resYear'), resFiling = $('resFiling'), estAmount = $('estAmount'), resCurrency = $('resCurrency');
const resTotalIncome = $('resTotalIncome'), resWages = $('resWages'), resInterest = $('resInterest'), resCapGains = $('resCapGains'), resBiz = $('resBiz');
const resTotalDed = $('resTotalDed'), resTaxable = $('resTaxable'), resRegularTax = $('resRegularTax'), resAMT = $('resAMT'), resNIIT = $('resNIIT');
const resAllCredits = $('resAllCredits'), resTaxWithCredits = $('resTaxWithCredits'), resPrepay = $('resPrepay'), finalRefund = $('finalRefund');

/* formatting */
function currencySymbol(c){ if(!c) c = currencySel.value; return c==='EUR' ? '€' : (c==='INR' ? '₹' : '$'); }
function fmt(n){ const val = Math.round(Number(n)||0); const s = Math.abs(val).toLocaleString(); return (val<0?'-':'') + currencySymbol() + s; }

/* rates map (1 USD = x) */
function getRates(){
  return { USD: Math.max(0.000001, Number(rateUSD.value)||1), EUR: Math.max(0.000001, Number(rateEUR.value)||0.92), INR: Math.max(0.000001, Number(rateINR.value)||83.5) };
}

/* convert numeric inputs from one currency to another */
let prevCurrency = currencySel.value || 'USD';
function convertAllInputs(from, to){
  if(!from || !to || from===to) return;
  const rates = getRates();
  const fromRate = rates[from], toRate = rates[to];
  if(!fromRate || !toRate) return;
  const factor = toRate / fromRate; // multiply current values by factor
  numericInputs().forEach(input=>{
    const v = Number(input.value) || 0;
    const nv = Math.round((v * factor) * 100) / 100;
    input.value = nv;
  });
}

/* --- tax math (same simplified estimator as before) --- */
/* standard deduction map */
const standardDeductions = { single:15750, married_joint:31500, married_separate:15750, head:23625, widow:31500 };

/* bracket structure simplified (estimator) */
const bracketStructure = {
  rates: [
    {rate:0.10, up:11925},
    {rate:0.12, up:48475},
    {rate:0.22, up:103350},
    {rate:0.24, up:197300},
    {rate:0.32, up:250525},
    {rate:0.35, up:626350},
    {rate:0.37, up: Infinity}
  ]
};

/* AMT params (approx) */
const amtParams = { exemption_single:81300, exemption_married:126500, amt_rate_low:0.26 };

/* NIIT params */
const niitThresholds = { single:200000, head:200000, married_joint:250000, married_separate:125000, widow:250000 };
const niitRate = 0.038;

function computeProgressiveTax(taxable){
  let remaining = Math.max(0, taxable), prev = 0, tax = 0;
  for(const br of bracketStructure.rates){
    const cap = br.up;
    const amount = Math.max(0, Math.min(remaining, cap - prev));
    tax += amount * br.rate;
    remaining -= amount;
    prev = cap;
    if(remaining <= 0) break;
  }
  return Math.round(tax);
}
function computeAMT(taxable, filingKey){
  const married = (filingKey === 'married_joint' || filingKey === 'widow');
  const exemption = married ? amtParams.exemption_married : amtParams.exemption_single;
  const tentativeBase = Math.max(0, taxable);
  const amtTax = Math.max(0, (tentativeBase - exemption) * amtParams.amt_rate_low);
  return Math.round(amtTax);
}
function computeNIIT(netInvestIncome, magi, filingKey){
  const thr = niitThresholds[filingKey] || niitThresholds.single;
  const excess = Math.max(0, magi - thr);
  const tax = Math.min(netInvestIncome, excess) * niitRate;
  return Math.round(tax);
}

/* main calculate (same as prior) */
function calculateAll(){
  const year = Number(taxYearSelect.value) || (new Date().getFullYear()+1);
  resYear.textContent = year;
  const filingKey = filing.value;
  resFiling.textContent = filingKey === 'single' ? 'Single' : filingKey === 'married_joint' ? 'Married filing jointly' : filingKey === 'married_separate' ? 'Married filing separately' : filingKey === 'head' ? 'Head of household' : 'Qualified widow(er)';

  const w = Number(wages.value) || 0;
  const it = Number(interest.value) || 0;
  const dv = Number(dividends.value) || 0;
  const qdv = Number(qualifiedDiv.value) || 0;
  const s = Number(stcg.value) || 0;
  const l = Number(ltcg.value) || 0;
  const biz = Number(selfBiz.value) || 0;
  const pas = Number(passive.value) || 0;
  const soc = Number(social.value) || 0;

  const totalIncome = w + it + dv + qdv + s + l + biz + pas + soc;
  const mort = Number(mortgage.value) || 0;
  const re = Number(realEstate.value) || 0;
  const ch = Number(charity.value) || 0;
  const sl = Number(studentLoan.value) || 0;
  const iraV = Number(ira.value) || 0;
  const otherD = Number(otherDed.value) || 0;
  const itemized = mort + re + ch + sl + iraV + otherD;
  const std = standardDeductions[filingKey] || standardDeductions.single;
  const totalDed = Math.max(std, itemized);

  const taxable = Math.max(0, Math.round(totalIncome - totalDed));
  const regularTax = computeProgressiveTax(taxable);
  const amtEstimate = computeAMT(taxable, filingKey);
  const netInvestIncome = it + dv + qdv + s + l + pas;
  const niit = computeNIIT(netInvestIncome, totalIncome, filingKey);

  const childCredit = Number(ctc.value) || 0;
  const otherCred = Number(otherCredits.value) || 0;
  const allCredits = Math.round(childCredit + otherCred);

  const taxWithCredits = Math.round(regularTax + amtEstimate + niit - allCredits);
  const fedWith = Number(fedWithheld.value) || 0;
  const stateWith = Number(stateWithheld.value) || 0;
  const prepay = Number(prepayments.value) || 0;
  const prepayTotal = fedWith + stateWith + prepay;
  const estimatedRefund = Math.round(prepayTotal - taxWithCredits);

  resCurrency.textContent = currencySymbol();
  estAmount.textContent = fmt(estimatedRefund);
  resTotalIncome.textContent = fmt(totalIncome);
  resWages.textContent = fmt(w);
  resInterest.textContent = fmt(it + dv);
  resCapGains.textContent = fmt(s + l);
  resBiz.textContent = fmt(biz + pas + soc);
  resTotalDed.textContent = fmt(totalDed);
  resTaxable.textContent = fmt(taxable);
  resRegularTax.textContent = fmt(regularTax);
  resAMT.textContent = fmt(amtEstimate);
  resNIIT.textContent = fmt(niit);
  resAllCredits.textContent = fmt(allCredits);
  resTaxWithCredits.textContent = fmt(taxWithCredits);
  resPrepay.textContent = fmt(prepayTotal);
  finalRefund.textContent = fmt(estimatedRefund);

  return { estimatedRefund };
}

/* export results as PNG using html2canvas */
exportBtn.addEventListener('click', ()=>{
  exportBtn.disabled = true; exportBtn.textContent = 'Exporting…';
  html2canvas($('resultPanel'), {scale:2, useCORS:true, backgroundColor:'#ffffff'}).then(canvas=>{
    const url = canvas.toDataURL('image/png');
    const a = document.createElement('a'); a.href = url; a.download = `income-tax-${taxYearSelect.value}.png`;
    document.body.appendChild(a); a.click(); a.remove();
  }).catch(e=>{ alert('Export failed'); console.error(e); })
  .finally(()=>{ exportBtn.disabled = false; exportBtn.textContent = 'Export PNG'; });
});

/* Reset */
clearBtn.addEventListener('click', ()=>{
  filing.value='single'; ageEl.value=30; wages.value=8000;
  interest.value=0; dividends.value=0; qualifiedDiv.value=0; stcg.value=0; ltcg.value=0; selfBiz.value=0; passive.value=0; social.value=0;
  mortgage.value=0; realEstate.value=0; charity.value=0; studentLoan.value=0; ira.value=0; otherDed.value=0;
  ctc.value=0; otherCredits.value=0; fedWithheld.value=6000; stateWithheld.value=0; prepayments.value=0;
  currencySel.value='USD';
  rateUSD.value=1; rateEUR.value=0.92; rateINR.value=83.5;
  taxYearSelect.value = String(new Date().getFullYear()+1);
  prevCurrency = currencySel.value;
  calculateAll();
});

/* currency change: auto-convert numeric inputs */
let prevCurrency = currencySel.value || 'USD';
currencySel.addEventListener('change', ()=>{
  const newC = currencySel.value;
  convertAllInputs(prevCurrency, newC);
  prevCurrency = newC;
  calculateAll();
});

/* if user edits rates, we don't auto apply conversions (avoids surprise) — user can change currency to trigger conversion after editing rates */

/* recalc on calculate */
calculateBtn.addEventListener('click', ()=> calculateAll());

/* initial load */
document.addEventListener('DOMContentLoaded', ()=>{
  taxYearSelect.value = String(new Date().getFullYear()+1);
  prevCurrency = currencySel.value;
  calculateAll();
});
</script>
</body>
</html>
