<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fixvity – Income Tax Calculator (2024–2028)</title>

<style>
/* ============================================================
   GLOBAL THEME (Teal Professional)
   ============================================================ */
:root{
    --teal:#0b7285;
    --teal-dark:#055160;
    --bg:#f4fafb;
    --text:#1c1f21;
    --muted:#6b6b6b;
    --white:#ffffff;
    --border:#d9e2e6;
    --radius:10px;
    font-family:Inter,system-ui,Arial;
}

body{
    margin:0;
    background:var(--bg);
    color:var(--text);
}

.container{
    max-width:1200px;
    margin:auto;
    padding:20px;
}

/* Title */
h1{
    text-align:center;
    color:var(--teal);
    font-size:30px;
    font-weight:800;
}

/* Section Label */
.section-title{
    background:var(--teal);
    color:white;
    padding:10px 14px;
    border-radius:var(--radius);
    font-size:20px;
    margin-top:20px;
    margin-bottom:10px;
}

/* Layout: Left Inputs + Right Results */
.grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:20px;
}
@media(max-width:900px){
    .grid{ grid-template-columns:1fr; }
}

/* Cards */
.card{
    background:var(--white);
    padding:16px;
    border-radius:var(--radius);
    border:1px solid var(--border);
    box-shadow:0 4px 18px rgba(0,0,0,0.05);
}

/* Input Rows */
.row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:14px;
}
.row label{
    flex:1;
    font-weight:600;
}
.row input, .row select{
    width:180px;
    padding:10px;
    border-radius:var(--radius);
    border:1px solid var(--border);
    font-size:15px;
}
.helper{
    flex-basis:150px;
    font-size:13px;
    color:var(--muted);
}
@media(max-width:900px){
    .row{ flex-direction:column; align-items:flex-start; }
    .row input, .row select{ width:100%; }
    .helper{ margin-top:4px; }
}

/* Buttons */
button{
    background:var(--teal);
    color:white;
    padding:10px 16px;
    border:0;
    border-radius:var(--radius);
    font-weight:700;
    cursor:pointer;
    margin-right:10px;
}
button:hover{ background:var(--teal-dark); }

</style>
</head>
<body>

<div class="container">
<h1>Fixvity – Income Tax Calculator (2024–2028)</h1>

<div class="grid">

<!-- ============================================================
     LEFT COLUMN – INPUTS
     ============================================================ -->
<div>

    <!-- Filing -->
    <div class="section-title">Filing Information</div>
    <div class="card">

        <div class="row">
            <label>Filing Status</label>
            <select id="filing">
                <option value="single">Single</option>
                <option value="married_joint">Married Filing Jointly</option>
                <option value="married_separate">Married Filing Separately</option>
                <option value="head">Head of Household</option>
                <option value="widow">Qualified Widow(er)</option>
            </select>
        </div>

        <div class="row">
            <label>Age</label>
            <input id="age" type="number" value="30" />
            <div class="helper">(Extra deduction at age 65+)</div>
        </div>

        <div class="row">
            <label>Dependents Under 17</label>
            <input id="depU17" type="number" value="0" />
        </div>

        <div class="row">
            <label>Other Dependents</label>
            <input id="depOther" type="number" value="0" />
        </div>
    </div>

    <!-- Income -->
    <div class="section-title">Income</div>
    <div class="card">

        <div class="row"><label>Wages</label><input id="wages" type="number" value="0" /><div class="helper">W-2 Box 1</div></div>
        <div class="row"><label>Federal Tax Withheld</label><input id="fedWithheld" type="number" value="0" /><div class="helper">W-2 Box 2</div></div>
        <div class="row"><label>State Withheld</label><input id="stateWithheld" type="number" value="0" /></div>
        <div class="row"><label>Local Withheld</label><input id="localWithheld" type="number" value="0" /></div>

        <div class="row"><label>Interest</label><input id="interest" type="number" value="0" /></div>
        <div class="row"><label>Dividends</label><input id="dividends" type="number" value="0" /></div>
        <div class="row"><label>Qualified Dividends</label><input id="qdiv" type="number" value="0" /></div>

        <div class="row"><label>Short-term Capital Gains</label><input id="stcg" type="number" value="0" /></div>
        <div class="row"><label>Long-term Capital Gains</label><input id="ltcg" type="number" value="0" /></div>

        <div class="row"><label>Business Income</label><input id="biz" type="number" value="0" /></div>
        <div class="row"><label>Other Income</label><input id="otherIncome" type="number" value="0" /></div>

    </div>

    <!-- Deductions -->
    <div class="section-title">Deductions</div>
    <div class="card">
        <div class="row"><label>Mortgage Interest</label><input id="mortgage" type="number" value="0" /></div>
        <div class="row"><label>Property Taxes</label><input id="realEstate" type="number" value="0" /></div>
        <div class="row"><label>Charity</label><input id="charity" type="number" value="0" /></div>
        <div class="row"><label>Student Loan Interest</label><input id="studentLoan" type="number" value="0" /></div>
        <div class="row"><label>IRA Contribution</label><input id="ira" type="number" value="0" /></div>
        <div class="row"><label>Education Expenses</label><input id="edu" type="number" value="0" /></div>
        <div class="row"><label>Other Deductions</label><input id="otherDed" type="number" value="0" /></div>
    </div>
</div>


<!-- ============================================================
     RIGHT COLUMN – RESULTS
     ============================================================ -->
<div>
    <div class="section-title">Results</div>

    <div class="card" id="resultsCard">

        <p><strong>Total Income:</strong> <span id="t_income">—</span></p>
        <p><strong>Taxable Income:</strong> <span id="t_taxable">—</span></p>

        <p><strong>Federal Tax:</strong> <span id="t_fed">—</span></p>
        <p><strong>Credits:</strong> <span id="t_credits">—</span></p>

        <p><strong>Total Tax Liability:</strong> <span id="t_liab">—</span></p>
        <p><strong>Total Payments:</strong> <span id="t_pay">—</span></p>

        <p><strong>Refund / Amount Due:</strong> <span id="t_ref">—</span></p>

        <br>

        <button id="calcBtn">Calculate</button>
        <button id="clearBtn" style="background:#999">Clear</button>
        <button id="savePNG">Download PNG</button>

    </div>
</div>

</div><!-- END GRID -->
</div><!-- END CONTAINER -->


<!-- ============================================================
     JAVASCRIPT (Complete IRS Engine + UI)
     ============================================================ -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
/* ===========================================================
   PART 2 — IRS DATA (2024–2028)
   =========================================================== */

const IRS = {

  /* ------------------------------
     STANDARD DEDUCTION (2024–2028)
     ------------------------------ */
  standardDeduction: {
    2024: {
      single: 14600,
      married_joint: 29200,
      married_separate: 14600,
      head: 21900,
      widow: 29200,
      addl65: 1650
    },
    2025: {
      single: 15700,
      married_joint: 31400,
      married_separate: 15700,
      head: 22500,
      widow: 31400,
      addl65: 1700
    },
    2026: {
      single: 16000,
      married_joint: 32000,
      married_separate: 16000,
      head: 23000,
      widow: 32000,
      addl65: 1750
    },
    2027: {
      single: 16400,
      married_joint: 32800,
      married_separate: 16400,
      head: 23500,
      widow: 32800,
      addl65: 1800
    },
    2028: {
      single: 16800,
      married_joint: 33600,
      married_separate: 16800,
      head: 24200,
      widow: 33600,
      addl65: 1850
    }
  },

  /* ------------------------------
     ORDINARY TAX BRACKETS (2024 base)
     ------------------------------ */
  brackets: {
    2024: {
      single: [
        [0,11000,0.10],
        [11000,44725,0.12],
        [44725,95375,0.22],
        [95375,182100,0.24],
        [182100,231250,0.32],
        [231250,578125,0.35],
        [578125,Infinity,0.37]
      ],
      married_joint: [
        [0,22000,0.10],
        [22000,89450,0.12],
        [89450,190750,0.22],
        [190750,364200,0.24],
        [364200,462500,0.32],
        [462500,693750,0.35],
        [693750,Infinity,0.37]
      ],
      married_separate: [
        [0,11000,0.10],
        [11000,44725,0.12],
        [44725,95375,0.22],
        [95375,182100,0.24],
        [182100,231250,0.32],
        [231250,346875,0.35],
        [346875,Infinity,0.37]
      ],
      head: [
        [0,15700,0.10],
        [15700,59850,0.12],
        [59850,95350,0.22],
        [95350,182100,0.24],
        [182100,231250,0.32],
        [231250,578100,0.35],
        [578100,Infinity,0.37]
      ],
      widow: [
        [0,22000,0.10],
        [22000,89450,0.12],
        [89450,190750,0.22],
        [190750,364200,0.24],
        [364200,462500,0.32],
        [462500,693750,0.35],
        [693750,Infinity,0.37]
      ]
    },

    /* Inflation-projected (multiplier applied to 2024) */
    2025: null,
    2026: null,
    2027: null,
    2028: null
  },

  /* ------------------------------
     CAPITAL GAINS BRACKETS (2024 base)
     ------------------------------ */
  capGains: {
    2024: {
      single: [
        [0,44725,0.00],
        [44725,492300,0.15],
        [492300,Infinity,0.20]
      ],
      married_joint: [
        [0,89450,0.00],
        [89450,553850,0.15],
        [553850,Infinity,0.20]
      ],
      head: [
        [0,59750,0.00],
        [59750,523050,0.15],
        [523050,Infinity,0.20]
      ]
    },

    2025: null,
    2026: null,
    2027: null,
    2028: null
  },

  /* ------------------------------
     CHILD TAX CREDIT (CTC)
     ------------------------------ */
  ctc: {
    amountUnder17: 2000,
    amountOther: 500,
    refundableLimit: 1600,
    phaseout: {
      single: 200000,
      married_joint: 400000,
      married_separate: 200000,
      head: 200000,
      widow: 400000
    }
  },

  /* ------------------------------
     EDUCATION CREDITS
     ------------------------------ */
  education: {
    aotc: {
      maxCredit: 2500,
      phaseStart: 80000,
      phaseEnd: 90000
    },
    llc: {
      maxCredit: 2000,
      phaseStart: 59000,
      phaseEnd: 69000
    }
  }
};

/* ===========================================================
   INFLATION HELPERS
   =========================================================== */

function inflateBrackets(base, multiplier){
  const out = {};
  for(const status in base){
    out[status] = base[status].map(b => [
      Math.round(b[0] * multiplier),
      Math.round(b[1] * multiplier),
      b[2]
    ]);
  }
  return out;
}

function inflateCapGains(base, multiplier){
  const out = {};
  for(const status in base){
    out[status] = base[status].map(b => [
      Math.round(b[0] * multiplier),
      Math.round(b[1] * multiplier),
      b[2]
    ]);
  }
  return out;
}

/* Apply inflation for 2025–2028 */
IRS.brackets["2025"] = inflateBrackets(IRS.brackets["2024"], 1.025);
IRS.brackets["2026"] = inflateBrackets(IRS.brackets["2024"], 1.05);
IRS.brackets["2027"] = inflateBrackets(IRS.brackets["2024"], 1.075);
IRS.brackets["2028"] = inflateBrackets(IRS.brackets["2024"], 1.10);

IRS.capGains["2025"] = inflateCapGains(IRS.capGains["2024"], 1.025);
IRS.capGains["2026"] = inflateCapGains(IRS.capGains["2024"], 1.05);
IRS.capGains["2027"] = inflateCapGains(IRS.capGains["2024"], 1.075);
IRS.capGains["2028"] = inflateCapGains(IRS.capGains["2024"], 1.10);
    /* ===========================================================
   PART 3 — FEDERAL TAX CALCULATION ENGINE
   =========================================================== */

/* ---------- Standard Deduction + Age Addon ---------- */
function getStandardDeduction(year, status, age){
  const base = IRS.standardDeduction[year][status];
  const add = IRS.standardDeduction[year].addl65;
  return age >= 65 ? base + add : base;
}

/* ---------- Progressive Tax (Ordinary Income) ---------- */
function computeRegularTax(taxable, year, status){
  if(taxable <= 0) return 0;

  const brackets = IRS.brackets[year][status];
  let tax = 0;

  for(const [low, high, rate] of brackets){
    if(taxable > low){
      const taxablePortion = Math.min(taxable, high) - low;
      if(taxablePortion > 0){
        tax += taxablePortion * rate;
      }
    }
  }
  return tax;
}

/* ---------- Long-term Capital Gains Tax ---------- */
function computeCapitalGainsTax(ltcg, taxableIncome, year, status){
  if(ltcg <= 0) return 0;

  const caps = IRS.capGains[year][status];
  let remaining = ltcg;
  let tax = 0;

  for(const [low, high, rate] of caps){
    const bracketLimit = high - taxableIncome;

    if(bracketLimit <= 0) continue;

    const portion = Math.min(remaining, bracketLimit);
    if(portion > 0){
      tax += portion * rate;
      remaining -= portion;
    }

    if(remaining <= 0) break;
  }

  return tax;
}

/* ---------- Child Tax Credit (CTC) Base ---------- */
function computeCTCBase(young, other){
  return young * IRS.ctc.amountUnder17 + other * IRS.ctc.amountOther;
}

/* ---------- CTC Phaseout ---------- */
function applyCTCPhaseout(agi, status, ctcAmount){
  const threshold = IRS.ctc.phaseout[status];
  if(agi <= threshold) return ctcAmount;

  const excess = agi - threshold;
  const reduction = Math.floor(excess / 1000) * 50;

  return Math.max(0, ctcAmount - reduction);
}

/* ---------- AOTC Education Credit ---------- */
function computeAOTC(edu, agi, year){
  if(edu <= 0) return 0;

  const e = IRS.education.aotc;
  const baseCredit = Math.min(edu * 0.25, e.maxCredit);

  if(agi <= e.phaseStart) return baseCredit;
  if(agi >= e.phaseEnd) return 0;

  const pct = (e.phaseEnd - agi) / (e.phaseEnd - e.phaseStart);
  return baseCredit * pct;
}

/* ---------- Lifetime Learning Credit (LLC) ---------- */
function computeLLC(edu, agi, year){
  if(edu <= 0) return 0;

  const e = IRS.education.llc;
  const baseCredit = Math.min(edu * 0.20, e.maxCredit);

  if(agi <= e.phaseStart) return baseCredit;
  if(agi >= e.phaseEnd) return 0;

  const pct = (e.phaseEnd - agi) / (e.phaseEnd - e.phaseStart);
  return baseCredit * pct;
}

/* ===========================================================
   MASTER FEDERAL TAX CALCULATOR (Main Function)
   =========================================================== */

function calculateFederalTax(data){

  const {
    year, status, age,
    wages, interest, dividends, qdiv,
    stcg, ltcg, selfBiz, passive,
    socialSec, otherIncome,

    mortgage, realEstate, charity,
    studentLoan, ira, education, otherDed,

    depYoung, depOther,

    fedWithheld, stateWithheld, localWithheld, prepayments,
    stateRate
  } = data;

  /* ------------------ INCOME ------------------ */
  const totalIncome =
      wages + interest + dividends + qdiv +
      stcg + ltcg + selfBiz + passive +
      socialSec + otherIncome;

  /* ------------------ DEDUCTION ------------------ */
  const itemized = mortgage + realEstate + charity +
                   studentLoan + ira + otherDed;

  const stdDeduction = getStandardDeduction(year, status, age);

  const deduction = Math.max(stdDeduction, itemized);
  const taxableIncome = Math.max(0, totalIncome - deduction);

  /* ------------------ TAX ------------------ */
  const regularTax = computeRegularTax(taxableIncome, year, status);
  const capTax = computeCapitalGainsTax(ltcg, taxableIncome, year, status);

  const fedTaxBeforeCredits = regularTax + capTax;

  /* ------------------ CREDITS ------------------ */
  const ctcBase = computeCTCBase(depYoung, depOther);
  const ctc = applyCTCPhaseout(totalIncome, status, ctcBase);

  const aotc = computeAOTC(education, totalIncome, year);
  const llc  = computeLLC(education, totalIncome, year);

  const totalCredits = ctc + aotc + llc;

  const taxAfterCredits = Math.max(0, fedTaxBeforeCredits - totalCredits);

  /* ------------------ PREPAYMENTS ------------------ */
  const prepay = fedWithheld + stateWithheld + localWithheld + prepayments;
  const refund = prepay - taxAfterCredits;

  /* ------------------ STATE TAX (simple estimate) ------------------ */
  const stateTax = taxableIncome * (stateRate / 100);

  /* ------------------ RETURN RESULT OBJECT ------------------ */
  return {
    totalIncome,
    deduction,
    taxableIncome,

    regularTax,
    capTax,
    fedTaxBeforeCredits,

    ctc, aotc, llc,
    totalCredits,

    taxAfterCredits,
    prepay,
    refund,

    stateTax
  };
}
    /* ===========================================================
   PART 4 — UI, EVENT HANDLERS, RENDERING, PNG EXPORT
   =========================================================== */

const $ = id => document.getElementById(id);

/* ------------------------------
   Currency formatting
   ------------------------------ */
function money(n){
  if(!Number.isFinite(n)) return "$0";
  return n.toLocaleString("en-US", {
    style: "currency",
    currency: "USD",
    maximumFractionDigits: 0
  });
}

/* ===========================================================
   COLLECT INPUTS → RETURN CLEAN DATA OBJECT
   =========================================================== */
function getFormData(){

  const year = Number($("taxYear").value);
  const status = $("filing").value;
  const age = Number($("age").value);

  const wages = Number($("wages").value)||0;
  const interest = Number($("interest").value)||0;
  const dividends = Number($("dividends").value)||0;
  const qdiv = Number($("qualifiedDiv").value)||0;

  const stcg = Number($("stcg").value)||0;
  const ltcg = Number($("ltcg").value)||0;

  const selfBiz = Number($("selfBiz").value)||0;
  const passive = Number($("passive").value)||0;
  const socialSec = Number($("socialSec").value)||0;
  const otherIncome = Number($("otherIncome").value)||0;

  const mortgage = Number($("mortgage").value)||0;
  const realEstate = Number($("realEstate").value)||0;
  const charity = Number($("charity").value)||0;
  const studentLoan = Number($("studentLoan").value)||0;
  const ira = Number($("ira").value)||0;
  const education = Number($("education").value)||0;
  const otherDed = Number($("otherDed").value)||0;

  const depYoung = Number($("depUnder17").value)||0;
  const depOther = Number($("depOther").value)||0;

  const fedWithheld = Number($("fedWithheld").value)||0;
  const stateWithheld = Number($("stateWithheld").value)||0;
  const localWithheld = Number($("localWithheld").value)||0;
  const prepayments = 0; // You wanted this removed

  const stateRate = Number($("stateRate").value)||0;

  return {
    year, status, age,

    wages, interest, dividends, qdiv,
    stcg, ltcg, selfBiz, passive,
    socialSec, otherIncome,

    mortgage, realEstate, charity,
    studentLoan, ira, education, otherDed,

    depYoung, depOther,

    fedWithheld, stateWithheld, localWithheld, prepayments,
    stateRate
  };
}

/* ===========================================================
   RENDER RESULTS TABLE (Calculator.net Style)
   =========================================================== */
function renderResults(r){

  $("out_totalIncome").textContent = money(r.totalIncome);
  $("out_taxable").textContent = money(r.taxableIncome);
  $("out_deduction").textContent = money(r.deduction);

  $("out_regtax").textContent = money(r.regularTax);
  $("out_captax").textContent = money(r.capTax);
  $("out_fedTax").textContent = money(r.fedTaxBeforeCredits);

  $("out_ctc").textContent = money(r.ctc);
  $("out_aotc").textContent = money(r.aotc);
  $("out_llc").textContent = money(r.llc);
  $("out_totalCredits").textContent = money(r.totalCredits);

  $("out_taxAfterCredits").textContent = money(r.taxAfterCredits);

  $("out_prepay").textContent = money(r.prepay);
  $("out_stateTax").textContent = money(r.stateTax);

  const ref = r.refund;
  if(ref >= 0){
    $("refundBox").textContent = money(ref);
    $("refundBox").style.color = "green";
  } else {
    $("refundBox").textContent = "Due " + money(Math.abs(ref));
    $("refundBox").style.color = "red";
  }
}

/* ===========================================================
   MAIN CALC → Fetch, Compute, Render
   =========================================================== */
function runCalc(){
  const data = getFormData();
  const r = calculateFederalTax(data);
  renderResults(r);
}

/* Auto calculate when user updates input */
document.querySelectorAll("input, select").forEach(el=>{
  el.addEventListener("input", runCalc);
});

/* Manual Calculate Button */
$("calcBtn").addEventListener("click", runCalc);

/* Clear Button */
$("clearBtn").addEventListener("click", ()=>{
  document.querySelectorAll("input").forEach(i=> i.value = 0);
  $("age").value = 30;
  runCalc();
});

/* ===========================================================
   PNG EXPORT using html2canvas
   =========================================================== */
$("savePNG").addEventListener("click", () => {
  const node = document.getElementById("resultsCard");

  html2canvas(node, {scale:2}).then(canvas=>{
    const a = document.createElement("a");
    a.href = canvas.toDataURL("image/png");
    a.download = "tax_results.png";
    a.click();
  });
});

/* Initial load */
runCalc();
</script>

</body>
</html>
