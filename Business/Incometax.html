<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Income Tax Calculator — 2025–2028 estimator</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<!-- html2canvas for PNG export -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
  :root{
    --bg:#f4f7f6; --card:#fff; --muted:#6b7176; --accent:#0b7285;
    --green:#10b981; --panel:#eef7f4; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#0b1720;-webkit-font-smoothing:antialiased}
  .wrap{max-width:980px;margin:18px auto;padding:14px}
  .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 8px 28px rgba(6,9,12,.06)}
  .headline{display:flex;align-items:center;gap:12px}
  .title{font-size:22px;margin:0;font-weight:800}
  .subtitle{color:var(--muted);margin:2px 0 12px;font-size:13px}
  .grid{display:grid;grid-template-columns:1fr;gap:18px}
  @media(min-width:920px){ .grid{grid-template-columns:380px 1fr} }
  .panel{background:linear-gradient(180deg,#fff,#fbfdff);padding:14px;border-radius:12px;border:1px solid rgba(12,18,24,0.06)}
  label{display:block;font-weight:600;margin-bottom:6px}
  .input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(12,18,24,0.12);font-size:16px;background:transparent}
  .row{display:flex;gap:12px}
  .row .col{flex:1}
  .small{font-size:13px;color:var(--muted);margin-top:6px}
  .btn{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  .btnGhost{background:#fff;border:1px solid rgba(12,18,24,0.08);padding:9px 12px;border-radius:10px;cursor:pointer}
  .select{padding:10px;border-radius:10px;border:1px solid rgba(12,18,24,0.08);font-size:15px}
  .resultCard{border-radius:12px;padding:10px;overflow:hidden}
  .resultTop{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#f7fffa,#f1fdf7)}
  .bigVal{font-size:36px;font-weight:800;color:var(--green)}
  .filingLabel{font-weight:700;color:#0b1720}
  .resultTable{width:100%;border-collapse:collapse;margin-top:10px}
  .resultTable td{padding:12px;border-bottom:1px solid rgba(6,9,12,.06)}
  .resultTable .label{color:var(--muted);font-weight:600}
  .resultTable .value{font-weight:800;text-align:right}
  .resultTable .section{background:var(--panel);font-weight:800}
  .resultFooter{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:8px;background:#f3ffef;margin-top:8px;font-weight:800}
  .muted{color:var(--muted);font-size:13px}
  .note{font-size:13px;color:var(--muted);margin-top:8px}
  @media(max-width:600px){
    .bigVal{font-size:30px}
    .headline{flex-direction:column;align-items:flex-start}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="headline">
      <div>
        <h1 class="title">Income Tax Calculator — Estimator</h1>
        <div class="subtitle">Includes AMT & NIIT estimators. Choose tax year (up to 2028). Export results to PNG.</div>
      </div>
      <div style="margin-left:auto">
        <label for="currency" class="small">Currency</label>
        <select id="currency" class="select">
          <option value="USD">$ USD</option>
          <option value="EUR">€ EUR</option>
          <option value="INR">₹ INR</option>
        </select>
      </div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="panel" aria-label="Inputs">
        <label for="taxYearSelect">Tax year (return for)</label>
        <select id="taxYearSelect" class="input">
          <option value="2025">2025</option>
          <option value="2026">2026</option>
          <option value="2027">2027</option>
          <option value="2028">2028</option>
        </select>

        <div style="margin-top:10px">
          <label for="filing">Filing status</label>
          <select id="filing" class="input">
            <option value="single">Single</option>
            <option value="married_joint">Married filing jointly</option>
            <option value="married_separate">Married filing separately</option>
            <option value="head">Head of household</option>
            <option value="widow">Qualified widow(er)</option>
          </select>
        </div>

        <div class="space" style="height:10px"></div>

        <label for="age">Age</label>
        <input id="age" class="input" type="number" min="0" value="30" />

        <div class="space" style="height:10px"></div>

        <label>Income (edit values)</label>
        <div style="display:grid;gap:10px">
          <input id="wages" class="input" type="number" placeholder="Wages, tips etc." value="8000" />
          <input id="interest" class="input" type="number" placeholder="Interest income" value="0" />
          <input id="dividends" class="input" type="number" placeholder="Ordinary dividends" value="0" />
          <input id="qualifiedDiv" class="input" type="number" placeholder="Qualified dividends" value="0" />
          <div class="row">
            <div class="col"><input id="stcg" class="input" type="number" placeholder="Short-term capital gains" value="0" /></div>
            <div class="col"><input id="ltcg" class="input" type="number" placeholder="Long-term capital gains" value="0" /></div>
          </div>
          <input id="selfBiz" class="input" type="number" placeholder="Self-employment / business income" value="0" />
          <input id="passive" class="input" type="number" placeholder="Passive income / rentals" value="0" />
          <input id="social" class="input" type="number" placeholder="Social Security income" value="0" />
        </div>

        <div class="space" style="height:10px"></div>

        <label>Deductions & credits</label>
        <div style="display:grid;gap:10px">
          <input id="mortgage" class="input" type="number" placeholder="Mortgage interest" value="0" />
          <input id="realEstate" class="input" type="number" placeholder="Real estate tax" value="0" />
          <input id="charity" class="input" type="number" placeholder="Charitable donations" value="0" />
          <input id="studentLoan" class="input" type="number" placeholder="Student loan interest" value="0" />
          <input id="ira" class="input" type="number" placeholder="IRA contributions" value="0" />
          <input id="otherDed" class="input" type="number" placeholder="Other deductible expenses" value="0" />
          <input id="ctc" class="input" type="number" placeholder="Child tax credit (estimate)" value="0" />
          <input id="otherCredits" class="input" type="number" placeholder="Other tax credits" value="0" />
        </div>

        <div class="space" style="height:10px"></div>

        <label>Withholdings & prepayments</label>
        <div style="display:grid;gap:10px">
          <input id="fedWithheld" class="input" type="number" placeholder="Federal tax withheld (W-2 box 2)" value="6000" />
          <input id="stateWithheld" class="input" type="number" placeholder="State tax withheld" value="0" />
          <input id="prepayments" class="input" type="number" placeholder="Estimated tax prepayments" value="0" />
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="calculateBtn" class="btn">Calculate</button>
          <button id="clearBtn" class="btnGhost">Reset</button>
          <button id="exportBtn" class="btnGhost" title="Export results as PNG">Export PNG</button>
        </div>

        <div class="note">
          This tool is an estimator. AMT and NIIT calculations are simplified for estimating purposes. For complex returns consult a tax professional.
        </div>
      </div>

      <!-- Results -->
      <div class="resultCard panel" id="resultPanel" role="region" aria-live="polite">
        <div class="resultTop">
          <div>
            <div class="muted">Estimated refund / balance for <span id="resYear"></span></div>
            <div class="bigVal" id="estAmount">$0</div>
          </div>
          <div style="text-align:right">
            <div class="muted">Filing</div>
            <div class="filingLabel" id="resFiling">Single</div>
            <div class="muted" style="margin-top:6px;font-weight:600">Currency: <span id="resCurrency">$</span></div>
          </div>
        </div>

        <table class="resultTable">
          <tr class="section"><td class="label">Total Income</td><td class="value" id="resTotalIncome">$0</td></tr>
          <tr><td class="label">Wages & Compensation</td><td class="value" id="resWages">$0</td></tr>
          <tr><td class="label">Interest & Dividends</td><td class="value" id="resInterest">$0</td></tr>
          <tr><td class="label">Capital gains (ST/LT)</td><td class="value" id="resCapGains">$0</td></tr>
          <tr><td class="label">Business / Passive / Other</td><td class="value" id="resBiz">$0</td></tr>

          <tr class="section"><td class="label">Total Deductions (std or itemized)</td><td class="value" id="resTotalDed">$0</td></tr>
          <tr><td class="label">Taxable Income</td><td class="value" id="resTaxable">$0</td></tr>

          <tr class="section"><td class="label">Regular Taxes (federal)</td><td class="value" id="resRegularTax">$0</td></tr>
          <tr><td class="label">Alternative Minimum Tax (AMT) — approx.</td><td class="value" id="resAMT">$0</td></tr>
          <tr><td class="label">Net Investment Income Tax (NIIT) — approx.</td><td class="value" id="resNIIT">$0</td></tr>

          <tr><td class="label">All Tax Credits</td><td class="value" id="resAllCredits">$0</td></tr>
          <tr class="section"><td class="label">Total Tax with Credits</td><td class="value" id="resTaxWithCredits">$0</td></tr>
          <tr><td class="label">Federal tax withheld + prepayments</td><td class="value" id="resPrepay">$0</td></tr>
        </table>

        <div class="resultFooter">
          <div class="muted">Estimated refund</div>
          <div id="finalRefund" style="font-weight:900;font-size:20px">$0</div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* --- helper shortcuts --- */
const $ = id => document.getElementById(id);

/* Inputs */
const taxYearSelect = $('taxYearSelect');
const filing = $('filing');
const ageEl = $('age');
const wages = $('wages'), interest = $('interest'), dividends = $('dividends'), qualifiedDiv = $('qualifiedDiv');
const stcg = $('stcg'), ltcg = $('ltcg'), selfBiz = $('selfBiz'), passive = $('passive'), social = $('social');
const mortgage = $('mortgage'), realEstate = $('realEstate'), charity = $('charity'), studentLoan = $('studentLoan'), ira = $('ira'), otherDed = $('otherDed');
const ctc = $('ctc'), otherCredits = $('otherCredits');
const fedWithheld = $('fedWithheld'), stateWithheld = $('stateWithheld'), prepayments = $('prepayments');
const currency = $('currency');

const calculateBtn = $('calculateBtn'), clearBtn = $('clearBtn'), exportBtn = $('exportBtn');

/* Results nodes */
const resYear = $('resYear'), resFiling = $('resFiling'), estAmount = $('estAmount'), resCurrency = $('resCurrency');
const resTotalIncome = $('resTotalIncome'), resWages = $('resWages'), resInterest = $('resInterest'), resCapGains = $('resCapGains'), resBiz = $('resBiz');
const resTotalDed = $('resTotalDed'), resTaxable = $('resTaxable'), resRegularTax = $('resRegularTax'), resAMT = $('resAMT'), resNIIT = $('resNIIT');
const resAllCredits = $('resAllCredits'), resTaxWithCredits = $('resTaxWithCredits'), resPrepay = $('resPrepay'), finalRefund = $('finalRefund');

/* --- currency symbol --- */
function currencySymbol(){
  const c = currency.value;
  return c === 'EUR' ? '€' : (c === 'INR' ? '₹' : '$');
}
function fmt(n){
  const val = Math.round(Number(n) || 0);
  const sym = currencySymbol();
  const s = Math.abs(val).toLocaleString();
  return (val<0?'-':'') + sym + s;
}

/* --- Tax parameters (simplified/estimates) ---
   Standard deductions used (2025-ish examples). For later years we leave same baseline here.
   Bracket structure simplified and shared for demonstration (progressive). These are used as an estimator.
   IMPORTANT: This is a reasonable estimator — not a replacement for official guidance.
*/
const standardDeductions = {
  single: 15750, married_joint: 31500, married_separate: 15750, head: 23625, widow: 31500
};

const bracketStructure = {
  // using same bracket cutoffs for all filing statuses here for simplification.
  // In real life each filing status has its own cutpoints; this is a pragmatic simplified estimator.
  rates: [
    {rate:0.10, up:11925},
    {rate:0.12, up:48475},
    {rate:0.22, up:103350},
    {rate:0.24, up:197300},
    {rate:0.32, up:250525},
    {rate:0.35, up:626350},
    {rate:0.37, up: Infinity}
  ]
};

/* AMT simplified params (approximated) */
const amtParams = {
  exemption_single: 81300,
  exemption_married: 126500,
  exemption_phaseout_start_single: 578150,
  exemption_phaseout_start_married: 1_156_300,
  amt_rate_low: 0.26, // 26% up to threshold
  amt_rate_high: 0.28 // 28% above threshold (not fully modelled here)
};

/* NIIT params */
const niitThresholds = { single:200000, head:200000, married_joint:250000, married_separate:125000, widow:250000 };
const niitRate = 0.038;

/* compute progressive tax (simple using bracketStructure.rates) */
function computeProgressiveTax(taxable){
  let remaining = Math.max(0, taxable);
  let prev = 0;
  let tax = 0;
  for(const br of bracketStructure.rates){
    const cap = br.up;
    const amount = Math.max(0, Math.min(remaining, cap - prev));
    tax += amount * br.rate;
    remaining -= amount;
    prev = cap;
    if(remaining <= 0) break;
  }
  return Math.round(tax);
}

/* compute AMT approx:
   - approximate AMT base = taxable income + preference adjustments (we don't model preferences, so use taxable)
   - compute exemption (simplified) and apply flat rate 26% to base - exemption
*/
function computeAMT(taxable, filingKey){
  // choose exemption
  const married = (filingKey === 'married_joint' || filingKey === 'widow');
  const exemption = married ? amtParams.exemption_married : amtParams.exemption_single;
  // simple tentative AMT
  const tentativeBase = Math.max(0, taxable); // simplification
  const amtTax = Math.max(0, (tentativeBase - exemption) * amtParams.amt_rate_low);
  return Math.round(amtTax);
}

/* compute NIIT (3.8% on lesser of net investment income and MAGI above threshold) */
function computeNIIT(netInvestIncome, magi, filingKey){
  const thr = niitThresholds[filingKey] || niitThresholds.single;
  const excess = Math.max(0, magi - thr);
  const tax = Math.min(netInvestIncome, excess) * niitRate;
  return Math.round(tax);
}

/* main calculate */
function calculateAll(){
  const year = Number(taxYearSelect.value) || (new Date().getFullYear()+1);
  resYear.textContent = year;

  const filingKey = filing.value;
  resFiling.textContent = (filingKey === 'single' ? 'Single' : filingKey === 'married_joint' ? 'Married filing jointly' : filingKey === 'married_separate' ? 'Married filing separately' : filingKey === 'head' ? 'Head of household' : 'Qualified widow(er)');

  // incomes
  const w = Number(wages.value) || 0;
  const it = Number(interest.value) || 0;
  const dv = Number(dividends.value) || 0;
  const qdv = Number(qualifiedDiv.value) || 0;
  const s = Number(stcg.value) || 0;
  const l = Number(ltcg.value) || 0;
  const biz = Number(selfBiz.value) || 0;
  const pas = Number(passive.value) || 0;
  const soc = Number(social.value) || 0;

  const totalIncome = w + it + dv + qdv + s + l + biz + pas + soc;

  // deductions: itemized vs standard
  const mort = Number(mortgage.value) || 0;
  const re = Number(realEstate.value) || 0;
  const ch = Number(charity.value) || 0;
  const sl = Number(studentLoan.value) || 0;
  const iraV = Number(ira.value) || 0;
  const otherD = Number(otherDed.value) || 0;
  const itemized = mort + re + ch + sl + iraV + otherD;
  const std = standardDeductions[filingKey] || standardDeductions.single;
  const totalDed = Math.max(std, itemized);

  const taxable = Math.max(0, Math.round(totalIncome - totalDed));

  // regular tax (progressive)
  const regularTax = computeProgressiveTax(taxable);

  // compute AMT (approx)
  const amtEstimate = computeAMT(taxable, filingKey);
  // compute NIIT: net investment income approximated as interest + dividends + capital gains + passive
  const netInvestIncome = it + dv + qdv + s + l + pas;
  const niit = computeNIIT(netInvestIncome, totalIncome, filingKey);

  // credits & prepayments
  const childCredit = Number(ctc.value) || 0;
  const otherCred = Number(otherCredits.value) || 0;
  const allCredits = Math.round(childCredit + otherCred);

  // total tax with credits
  const taxWithCredits = Math.round(regularTax + amtEstimate + niit - allCredits);

  // withheld & prepayments
  const fedWith = Number(fedWithheld.value) || 0;
  const stateWith = Number(stateWithheld.value) || 0;
  const prepay = Number(prepayments.value) || 0;
  const prepayTotal = fedWith + stateWith + prepay;

  const estimatedRefund = Math.round(prepayTotal - taxWithCredits);

  // update UI formatted
  resCurrency.textContent = currencySymbol();
  estAmount.textContent = fmt(estimatedRefund);
  resTotalIncome.textContent = fmt(totalIncome);
  resWages.textContent = fmt(w);
  resInterest.textContent = fmt(it + dv);
  resCapGains.textContent = fmt(s + l);
  resBiz.textContent = fmt(biz + pas + soc);

  resTotalDed.textContent = fmt(totalDed);
  resTaxable.textContent = fmt(taxable);
  resRegularTax.textContent = fmt(regularTax);
  resAMT.textContent = fmt(amtEstimate);
  resNIIT.textContent = fmt(niit);
  resAllCredits.textContent = fmt(allCredits);
  resTaxWithCredits.textContent = fmt(taxWithCredits);
  resPrepay.textContent = fmt(prepayTotal);
  finalRefund.textContent = fmt(estimatedRefund);

  return { regularTax, amtEstimate, niit, taxWithCredits, estimatedRefund };
}

/* Reset handler */
clearBtn.addEventListener('click', ()=>{
  // set sensible defaults
  filing.value = 'single';
  ageEl.value = 30;
  wages.value = 8000;
  interest.value = 0; dividends.value = 0; qualifiedDiv.value = 0;
  stcg.value = 0; ltcg.value = 0; selfBiz.value = 0; passive.value = 0; social.value = 0;
  mortgage.value = 0; realEstate.value = 0; charity.value = 0; studentLoan.value = 0; ira.value = 0; otherDed.value = 0;
  ctc.value = 0; otherCredits.value = 0;
  fedWithheld.value = 6000; stateWithheld.value = 0; prepayments.value = 0;
  currency.value = 'USD';
  taxYearSelect.value = String(new Date().getFullYear()+1);
  calculateAll();
});

/* Export PNG using html2canvas (results panel only) */
exportBtn.addEventListener('click', ()=>{
  const panel = document.getElementById('resultPanel');
  exportBtn.disabled = true;
  exportBtn.textContent = 'Exporting…';
  html2canvas(panel, {scale:2, useCORS:true, backgroundColor:'#ffffff'}).then(canvas=>{
    const url = canvas.toDataURL('image/png');
    const a = document.createElement('a');
    a.href = url;
    a.download = `income-tax-${taxYearSelect.value}.png`;
    document.body.appendChild(a);
    a.click();
    a.remove();
  }).catch(err=>{
    alert('PNG export failed: ' + (err && err.message ? err.message : 'unknown error'));
  }).finally(()=>{
    exportBtn.disabled = false;
    exportBtn.textContent = 'Export PNG';
  });
});

/* calculate on button click */
calculateBtn.addEventListener('click', ()=> calculateAll());

/* currency change updates symbols on display (no conversion) */
currency.addEventListener('change', ()=> calculateAll());

/* initial render */
document.addEventListener('DOMContentLoaded', ()=>{
  taxYearSelect.value = String(new Date().getFullYear()+1);
  calculateAll();
});
</script>
</body>
</html>
