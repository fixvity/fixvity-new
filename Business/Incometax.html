<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Income Tax Calculator — Live Currency</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f4f7f8; --card:#fff; --accent:#2b8a78; --muted:#6b7176;
    --panel:#e9f6f2; --border:rgba(13,20,25,0.06);
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  }
  html,body{height:100%;margin:0;background:var(--bg);-webkit-font-smoothing:antialiased}
  .wrap{max-width:1100px;margin:18px auto;padding:18px}
  .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 10px 26px rgba(12,18,24,0.06)}
  h1{margin:0 0 12px;font-size:20px}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
  @media(max-width:980px){ .grid{grid-template-columns:1fr} }

  /* form */
  .form{padding:12px;border-radius:10px;border:1px solid var(--border);background:linear-gradient(#fff,#fbffff)}
  .row{display:flex;gap:12px;align-items:center;margin-bottom:12px}
  .col{flex:1}
  label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px}
  input[type="text"], input[type="number"], select{
    width:100%;padding:12px;border-radius:8px;border:1px solid rgba(10,40,60,0.08);
    font-size:16px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.6)
  }
  .small{max-width:150px}
  .btn{display:inline-block;padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
  .btn.ghost{background:#fff;border:1px solid var(--border);color:#111}
  .legend{font-size:13px;color:var(--muted);margin-bottom:8px}

  /* results */
  .results{padding:12px;border-radius:10px;border:1px solid var(--border);background:linear-gradient(#fff,#fbffff)}
  .big{font-size:36px;font-weight:800;color:#0b3b34;margin:8px 0}
  .summary{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .summary .left{flex:1}
  .table{margin-top:12px;border-collapse:collapse;width:100%}
  .table td{padding:10px;border-bottom:1px solid #eef2f2}
  .table .label{color:var(--muted)}
  .table .value{text-align:right;font-weight:700}

  /* currency row */
  .ratesRow{display:flex;gap:8px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
  .ratesRow .note{font-size:13px;color:var(--muted)}
  .inline{display:inline-flex;gap:8px;align-items:center}

  /* footer small */
  .smallNote{font-size:12px;color:var(--muted);margin-top:12px}

</style>
</head>
<body>
<div class="wrap">
  <div class="card" role="main" aria-labelledby="title">
    <h1 id="title">Income Tax Calculator — Live Currency</h1>
    <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap">
      <div class="legend">Rates source: <strong>Frankfurter public API</strong> (no API key needed).</div>
      <div style="margin-left:auto" id="rateStatus">Rates: <span id="rateTime">—</span></div>
    </div>

    <div class="grid">
      <!-- LEFT: Inputs -->
      <section class="form" aria-label="Inputs">
        <div class="row">
          <div class="col small">
            <label for="currencyFrom">Input currency</label>
            <select id="currencyFrom">
              <option value="USD">USD — US Dollar</option>
              <option value="EUR">EUR — Euro</option>
              <option value="GBP">GBP — British Pound</option>
              <option value="INR">INR — Indian Rupee</option>
              <option value="AUD">AUD — Australian Dollar</option>
              <option value="CAD">CAD — Canadian Dollar</option>
            </select>
          </div>

          <div class="col small">
            <label for="currencyTo">Display currency</label>
            <select id="currencyTo">
              <option value="USD">USD — US Dollar</option>
              <option value="EUR">EUR — Euro</option>
              <option value="GBP">GBP — British Pound</option>
              <option value="INR">INR — Indian Rupee</option>
              <option value="AUD">AUD — Australian Dollar</option>
              <option value="CAD">CAD — Canadian Dollar</option>
            </select>
          </div>

          <div style="margin-left:auto" class="inline">
            <button id="btnRefresh" class="btn ghost">Refresh rates</button>
            <label style="font-size:13px;color:var(--muted);display:flex;align-items:center;gap:6px">
              <input id="autoRefresh" type="checkbox" /> auto-refresh (30m)
            </label>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid #eef2f2;margin:10px 0" />

        <div class="row">
          <div class="col">
            <label for="fileStatus">Filing status</label>
            <select id="fileStatus">
              <option value="single">Single</option>
              <option value="married_joint">Married filing jointly</option>
              <option value="married_separate">Married filing separately</option>
              <option value="head">Head of household</option>
              <option value="widow">Qualified widow(er)</option>
            </select>
          </div>
          <div class="col small">
            <label for="taxYear">Tax year (return filed)</label>
            <select id="taxYear"></select>
          </div>
        </div>

        <div class="row">
          <div class="col small">
            <label for="age">Age</label>
            <input id="age" type="number" min="0" value="30" />
          </div>
          <div class="col small">
            <label for="dependYoung"># young dependents (0-16)</label>
            <input id="dependYoung" type="number" min="0" value="0" />
          </div>
          <div class="col small">
            <label for="dependOther"># other dependents</label>
            <input id="dependOther" type="number" min="0" value="0" />
          </div>
        </div>

        <h3 style="margin-top:8px">Income (enter amounts in input currency)</h3>
        <div class="row">
          <div class="col">
            <label for="wages">Wages, tips, other compensation</label>
            <input id="wages" type="number" step="0.01" value="8000" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="interest">Interest income (1099-INT)</label>
            <input id="interest" type="number" step="0.01" value="0" />
          </div>
          <div class="col">
            <label for="dividends">Ordinary dividends</label>
            <input id="dividends" type="number" step="0.01" value="0" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="stgains">Short-term capital gains</label>
            <input id="stgains" type="number" step="0.01" value="0" />
          </div>
          <div class="col">
            <label for="ltgains">Long-term capital gains</label>
            <input id="ltgains" type="number" step="0.01" value="0" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="business">Business / passive / other</label>
            <input id="business" type="number" step="0.01" value="0" />
          </div>
          <div class="col">
            <label for="prepayments">Federal tax withheld / prepayments</label>
            <input id="prepayments" type="number" step="0.01" value="6000" />
          </div>
        </div>

        <h3 style="margin-top:8px">Deductions & credits / other</h3>

        <div class="row">
          <div class="col">
            <label for="charity">Charitable donations</label>
            <input id="charity" type="number" step="0.01" value="0" />
          </div>
          <div class="col">
            <label for="mortgage">Mortgage interest</label>
            <input id="mortgage" type="number" step="0.01" value="0" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="ira">IRA / Retirement contributions</label>
            <input id="ira" type="number" step="0.01" value="0" />
          </div>
          <div class="col">
            <label for="otherDed">Other deductible expenses</label>
            <input id="otherDed" type="number" step="0.01" value="200" />
          </div>
        </div>

        <div style="display:flex;gap:10px;margin-top:12px">
          <button id="btnCalc" class="btn">Calculate</button>
          <button id="btnClear" class="btn ghost">Clear</button>
        </div>

        <div class="smallNote">Tip: choose input/display currency then Refresh rates. Rates are courtesy of Frankfurter API (no key required). 1</div>
      </section>

      <!-- RIGHT: Results -->
      <aside class="results" aria-live="polite">
        <div class="summary">
          <div class="left">
            <div style="font-size:13px;color:var(--muted)">Estimated refund / balance for <span id="displayYear">—</span></div>
            <div class="big" id="estimatedAmount">—</div>
            <div style="font-size:13px;color:var(--muted)">Filing status: <strong id="displayStatus">—</strong></div>
          </div>
        </div>

        <table class="table" role="table" aria-label="Summary">
          <tr><td class="label">Total Income</td><td class="value" id="out_totalIncome">—</td></tr>
          <tr><td class="label">Wages & Compensation</td><td class="value" id="out_wages">—</td></tr>
          <tr><td class="label">Interest & Dividends</td><td class="value" id="out_interest">—</td></tr>
          <tr><td class="label">Capital gains (ST/LT)</td><td class="value" id="out_gains">—</td></tr>
          <tr><td class="label">Business / Passive / Other</td><td class="value" id="out_business">—</td></tr>
          <tr style="background:var(--panel)"><td class="label">Total Deductions</td><td class="value" id="out_deductions">—</td></tr>
          <tr><td class="label">Taxable Income</td><td class="value" id="out_taxable">—</td></tr>
          <tr style="background:var(--panel)"><td class="label">Regular Taxes (federal)</td><td class="value" id="out_taxes">—</td></tr>
          <tr><td class="label">All Tax Credits</td><td class="value" id="out_credits">—</td></tr>
          <tr style="background:var(--panel)"><td class="label">Total Tax with Credits</td><td class="value" id="out_totalTax">—</td></tr>
          <tr><td class="label">Federal tax withheld + prepayments</td><td class="value" id="out_withheld">—</td></tr>
          <tr style="background:#eefef6"><td class="label">Estimated refund</td><td class="value" id="out_refund">—</td></tr>
        </table>

        <div class="smallNote" id="rateNote">Converted display currency values use latest live rates.</div>
      </aside>
    </div>
  </div>
</div>

<script>
/* Live-currency income tax calculator
   - Uses Frankfurter public API (no API key). See: https://www.frankfurter.app/
   - All money inputs are entered in "input currency" (currencyFrom).
   - For internal calc we convert into a base "USD" for taxation logic (you can change).
   - For display we convert to "currencyTo" and show converted values next to results.
   - Basic tax calculation placeholder provided (simple progressive US-like brackets for example).
*/

/* -------------------------
   Utilities & DOM bindings
   ------------------------- */
const $ = sel => document.querySelector(sel);
const currencyFrom = $('#currencyFrom');
const currencyTo = $('#currencyTo');
const btnRefresh = $('#btnRefresh');
const autoRefresh = $('#autoRefresh');
const rateTime = $('#rateTime');
const taxYearSelect = $('#taxYear');
const btnCalc = $('#btnCalc');
const btnClear = $('#btnClear');

const inputs = {
  wages: $('#wages'),
  interest: $('#interest'),
  dividends: $('#dividends'),
  stgains: $('#stgains'),
  ltgains: $('#ltgains'),
  business: $('#business'),
  prepayments: $('#prepayments'),
  charity: $('#charity'),
  mortgage: $('#mortgage'),
  ira: $('#ira'),
  otherDed: $('#otherDed'),
  fileStatus: $('#fileStatus'),
  age: $('#age'),
  dependYoung: $('#dependYoung'),
  dependOther: $('#dependOther'),
  taxYear: $('#taxYear')
};

const outputs = {
  estimatedAmount: $('#estimatedAmount'),
  displayStatus: $('#displayStatus'),
  displayYear: $('#displayYear'),
  out_totalIncome: $('#out_totalIncome'),
  out_wages: $('#out_wages'),
  out_interest: $('#out_interest'),
  out_gains: $('#out_gains'),
  out_business: $('#out_business'),
  out_deductions: $('#out_deductions'),
  out_taxable: $('#out_taxable'),
  out_taxes: $('#out_taxes'),
  out_credits: $('#out_credits'),
  out_totalTax: $('#out_totalTax'),
  out_withheld: $('#out_withheld'),
  out_refund: $('#out_refund'),
  rateNote: $('#rateNote')
};

/* rates cache */
let rates = { base: 'USD', date: null, rates: {} };
let autoTimer = null;

/* Fill tax year select (auto update) */
(function populateYears(){
  const now = new Date();
  const currentYear = now.getFullYear();
  // If you file this year for prior tax year, allow range: (currentYear-1) and current etc.
  const years = [currentYear-1, currentYear];
  taxYearSelect.innerHTML = years.map(y => `<option value="${y}">${y} (return filed in ${y+1})</option>`).join('');
  // default to previous tax year (commonly currentYear-1)
  taxYearSelect.value = currentYear-1;
  outputs.displayYear.textContent = taxYearSelect.value;
})();

/* -------------------------
   Fetch live rates (Frankfurter)
   - Example: https://api.frankfurter.app/latest?from=USD
   ------------------------- */
async function fetchRates(base='USD'){
  try{
    const url = `https://api.frankfurter.app/latest?from=${encodeURIComponent(base)}`;
    const resp = await fetch(url, { cache: "no-store" });
    if(!resp.ok) throw new Error('Rate fetch failed');
    const data = await resp.json();
    // data: {amount:1, base:'USD', date:'2025-..', rates:{EUR:0.9,...}}
    rates = { base: data.base || base, date: data.date || new Date().toISOString().slice(0,10), rates: data.rates || {} };
    rateTime.textContent = `${rates.date} (base ${rates.base})`;
    outputs.rateNote.textContent = `Rates updated ${rates.date}; source: Frankfurter API (no key).`;
    return rates;
  }catch(err){
    rateTime.textContent = 'Failed to fetch rates';
    outputs.rateNote.textContent = 'Rate fetch failed — using last-known or 1:1 fallback.';
    console.warn('fetchRates error', err);
    return rates;
  }
}

/* Convert amount from A -> B using rates object
   frankfurter returns rates relative to base (e.g. rates[EUR] = 0.91 when base=USD)
*/
function convert(amount, a='USD', b='USD'){
  if(a === b) return Number(amount || 0);
  // ensure we have rates with base = rates.base
  // formula: amount_in_b = amount * (rate_b_base / rate_a_base)
  // If a === rates.base: amount * rate_b
  const r = rates.rates || {};
  const base = rates.base || 'USD';
  // handle known simple cases
  if(a === base){
    const rb = r[b];
    if(rb) return Number(amount) * rb;
  }
  if(b === base){
    const ra = r[a];
    if(ra) return Number(amount) / ra;
  }
  // general: convert a->base, then base->b
  const ra = (r[a] ? r[a] : (a === base ? 1 : null));
  const rb = (r[b] ? r[b] : (b === base ? 1 : null));
  if(ra === null || rb === null){
    // fallback: if missing rates for requested currency, try fetching with different base
    // fallback to 1:1 to avoid crash
    return Number(amount || 0);
  }
  const inBase = Number(amount || 0) / ra;
  return inBase * rb;
}

/* Re-run auto-refresh */
function scheduleAutoRefresh(){
  if(autoTimer) { clearInterval(autoTimer); autoTimer=null; }
  if(autoRefresh.checked){
    // refresh every 30 minutes (1800000 ms). For demo keep 30m; here set 30m.
    autoTimer = setInterval(()=>fetchRates(rates.base), 30 * 60 * 1000);
  }
}

/* UI handlers */
btnRefresh.addEventListener('click', ()=>fetchRates(rates.base));
currencyFrom.addEventListener('change', ()=>{/* no-op for now */});
currencyTo.addEventListener('change', ()=>{/* no-op for now */});
autoRefresh.addEventListener('change', scheduleAutoRefresh);

taxYearSelect.addEventListener('change', ()=>{
  outputs.displayYear.textContent = taxYearSelect.value;
});

/* clear */
btnClear.addEventListener('click', ()=>{
  Object.values(inputs).forEach(i => {
    if(i.tagName === 'SELECT') {
      // reset selects to defaults
      if(i.id === 'fileStatus') i.value='single';
      if(i.id === 'taxYear') { /* keep selected */ }
    } else {
      if(i.type === 'number') i.value = 0;
    }
  });
  inputs.wages.value = 0;
  inputs.prepayments.value = 0;
  // reset outputs
  Object.values(outputs).forEach(o => { if(o) o.textContent = '—' });
  outputs.displayYear.textContent = taxYearSelect.value;
  outputs.displayStatus.textContent = '';
});

/* -------------------------
   Basic tax calculation logic (example)
   - This is a simplified placeholder; integrate your own tax logic
   - We'll: convert user inputs from input-currency to a base currency (USD), compute totals,
     apply a very simple progressive tax (demo), apply deductions, credits, and produce an estimated refund.
   ------------------------- */

function computeTaxesInBaseCurrency(values /* all numbers already in BASE currency */) {
  // values: {wages, interest, dividends, stgains, ltgains, business, deductionsTotal, prepayments, filing}
  // For demo purposes, we apply a simplified progressive tax table (federal only).
  // NOTE: Replace with your authoritative tax rules as needed.
  const filing = values.filing;
  const taxable = Math.max(0, values.totalIncome - values.deductionsTotal);

  // Example progressive brackets (very simplified / illustrative ONLY)
  // brackets = [ [threshold, rate], ... ] threshold = lower bound
  // Use single filer for demo
  const brackets_single = [
    [0, 0.10],
    [11000, 0.12],
    [44726, 0.22],
    [95376, 0.24],
    [182101, 0.32],
    [231251, 0.35],
    [578126, 0.37]
  ];
  const brackets = (filing === 'single') ? brackets_single : brackets_single; // placeholder

  // compute tax
  let tax = 0;
  let remaining = taxable;
  for(let i=brackets.length-1;i>=0;i--){
    const [th, rate] = brackets[i];
    if(taxable > th){
      const amountAtThisRate = taxable - th;
      tax += amountAtThisRate * rate;
      taxable = th;
    }
  }

  // For demo: credits fixed 0 (user could add child credit logic etc.)
  const credits = 0;

  const totalTaxWithCredits = tax - credits;
  const refund = values.prepayments - totalTaxWithCredits;

  return {
    taxableIncome: remaining >= 0 ? remaining : 0,
    regularTax: Math.max(0, tax),
    credits,
    totalTaxWithCredits,
    refund
  };
}

/* Helper: format money in chosen currencyTo */
function formatMoney(amount, currency){
  const opts = { style:'currency', currency, maximumFractionDigits:2 };
  try {
    return new Intl.NumberFormat(undefined, opts).format(Number(amount || 0));
  } catch(e){
    // fallback
    return (Number(amount||0)).toFixed(2) + ' ' + currency;
  }
}

/* Main calculate handler */
async function calculate(){
  // ensure rates loaded
  await fetchRates(rates.base);

  const from = currencyFrom.value;
  const to = currencyTo.value;
  // Choose a stable BASE currency for internal logic (we'll use USD)
  const BASE = 'USD';
  // If our rates base is not BASE, we can fetch with BASE as base to ensure direct conversion, but frankfurter returns many rates against base.
  if(rates.base !== BASE){
    // Try re-fetch with base=BASE to reduce rounding steps
    await fetchRates(BASE);
  }

  // Gather input amounts and convert them from input currency -> BASE
  function inp(id){
    const v = Number(document.getElementById(id).value || 0);
    return convert(v, from, BASE);
  }

  const wages_base = inp('wages');
  const interest_base = inp('interest');
  const dividends_base = inp('dividends');
  const stgains_base = inp('stgains');
  const ltgains_base = inp('ltgains');
  const business_base = inp('business');

  const prepayments_base = inp('prepayments');
  const charity_base = inp('charity');
  const mortgage_base = inp('mortgage');
  const ira_base = inp('ira');
  const otherDed_base = inp('otherDed');

  // Basic totals
  const totalIncome_base = wages_base + interest_base + dividends_base + stgains_base + ltgains_base + business_base;
  // Deductions: for demo we combine entered deductions + standard deduction placeholder
  const filingStatus = inputs.fileStatus.value;
  const standardDeduction = (filingStatus === 'single' ? 13500 : 27000); // demo placeholders
  const deductionsTotal_base = standardDeduction + charity_base + mortgage_base + ira_base + otherDed_base;

  // Compute tax (demo function)
  const taxResult = computeTaxesInBaseCurrency({
    wages: wages_base,
    interest: interest_base,
    dividends: dividends_base,
    stgains: stgains_base,
    ltgains: ltgains_base,
    business: business_base,
    deductionsTotal: deductionsTotal_base,
    prepayments: prepayments_base,
    filing: filingStatus
  });

  // Convert outputs to display currency (to)
  const conv = amt => convert(amt, BASE, to);

  // Populate results
  outputs.out_totalIncome.textContent = formatMoney(conv(totalIncome_base), to);
  outputs.out_wages.textContent = formatMoney(conv(wages_base), to);
  outputs.out_interest.textContent = formatMoney(conv(interest_base + dividends_base), to);
  outputs.out_gains.textContent = formatMoney(conv(stgains_base + ltgains_base), to);
  outputs.out_business.textContent = formatMoney(conv(business_base), to);
  outputs.out_deductions.textContent = formatMoney(conv(deductionsTotal_base), to);
  outputs.out_taxable.textContent = formatMoney(conv(taxResult.taxableIncome), to);
  outputs.out_taxes.textContent = formatMoney(conv(taxResult.regularTax), to);
  outputs.out_credits.textContent = formatMoney(conv(taxResult.credits), to);
  outputs.out_totalTax.textContent = formatMoney(conv(taxResult.totalTaxWithCredits), to);
  outputs.out_withheld.textContent = formatMoney(conv(prepayments_base), to);
  outputs.out_refund.textContent = formatMoney(conv(taxResult.refund), to);

  outputs.estimatedAmount.textContent = formatMoney(conv(taxResult.refund), to);
  outputs.displayStatus.textContent = inputs.fileStatus.options[inputs.fileStatus.selectedIndex].text;
  outputs.displayYear.textContent = taxYearSelect.value;
}

/* init: load rates on startup and schedule auto-refresh */
(async function init(){
  // initial fetch using USD base
  await fetchRates('USD');
  scheduleAutoRefresh();

  // attach calculate
  btnCalc.addEventListener('click', async (e) => {
    e.preventDefault();
    await calculate();
  });

  // initial calculate (nice-to-have)
  await calculate();
})();

</script>
</body>
</html>
